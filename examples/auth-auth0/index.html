<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <meta property="og:title" content="milkcocoaを利用した認証のサンプル" />
    <title>milkcocoaを利用した認証のサンプル</title>
    <link rel="stylesheet" href="style.css" type="text/css" />
    <script src="http://code.jquery.com/jquery-1.11.1.min.js"></script>
    <script src="http://cdn.mlkcca.com/v2.0.0/milkcocoa.js"></script>
    <script src="https://cdn.auth0.com/js/lock-6.js"></script>

	<!-- Setting the right viewport -->
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />

    <script>
    $(function() {

    	    var lock = new Auth0Lock(
    	    	'z2RcQboX6E8c2yxUPZIqPaA6rdQdXQUF',
    	    	'milkcocoa.auth0.com'
    	    	);

        //var milkcocoa = new MilkCocoa("localhost", {app_id : "iotest0", port : 8001, useSSL : false});
        var milkcocoa = new MilkCocoa("unii8fmjtlc.mlkcca.com", {app_id : "unii8fmjtlc"});

        $("#user").click(function() {
	        milkcocoa.user(function(err, user) {
	        	if(user.condition == "loggedin")
		        	$("#output").html("ログイン済み" + user.id);
		        else
		        	$("#output").html("ログインしてください。");
	        });
        });

        $("#login").click(function() {
        	lock.showSignin(function(err, profile, token) {
        		if (err) {
        			return;
        		}
        		console.log(err, profile, token);
                milkcocoa.authWithToken(token, function(err, user){console.log(user);});
        	});
        });
    });
    //インジェクション対策
    function escapeHTML(val) {
        return $('<div>').text(val).html();
    };
    </script>
</head>

<body>

    <button id="login">ログイン</button>
    <button id="user">ユーザ情報取得</button>
    <div id="output"></div>
    <p class="footer"><strong>Powered by <a href="http://mlkcca.com/">Milkcocoa</a></strong></p>
</body>
</html>
